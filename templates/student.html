<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Student Form</title>

    <!-- W3CSS -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <!-- Shared CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="page-body">

    <!-- TOP BAR ONLY -->
    <header class="top-bar">
        <div class="course-title">PYTHON(19877) 8:00â€“10:30</div>
    </header>

    <!-- CENTERED CONTENT (no sidebar) -->
    <div class="student-form-wrapper">

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages" style="margin-top:15px;">
            {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <h3 class="admin-section-title" style="margin-top:10px;">
            {% if student %}EDIT STUDENT{% else %}ADD STUDENT{% endif %}
        </h3>

        <section class="admin-panel">
            <!-- IMPORTANT: we add a hidden field for the captured image -->
            <form method="post">
                <input type="hidden" name="photo_data" id="photo-data-input">

                <!-- CAMERA + RESULT -->
                <div class="student-top-row">

                    <!-- CAMERA -->
                    <div class="student-top-col">
                        <div class="oval-title">CAMERA VIEWER</div>
                        <div id="camera-viewer" class="camera-box">
                            <span style="font-size: 12px; color: #777;">Camera preview here</span>
                        </div>

                        <button type="button" class="admin-btn-primary admin-btn-small" id="capture-btn"
                            style="margin-top:10px;">
                            CAPTURE
                        </button>
                    </div>

                    <!-- RESULT -->
                    <div class="student-top-col">
                        <div class="oval-title">RESULT</div>

                        <div class="photo-result-box">
                            <!-- Always hidden at first, no src -->
                            <img id="photo-result" alt="Captured photo" style="display:none;">

                            <!-- Always show "No photo captured" at first -->
                            <span id="photo-placeholder" style="font-size:12px;color:#777;">
                                No photo captured
                            </span>
                        </div>

                    </div>
                </div>

                <!-- FIELDS -->
                <div class="student-fields">
                    <label class="admin-form-label">IDNO</label>
                    <input class="w3-input w3-border admin-form-input" type="text" name="student_id" required
                        value="{{ student.student_id if student else '' }}">

                    <label class="admin-form-label">LASTNAME</label>
                    <input class="w3-input w3-border admin-form-input" type="text" name="last_name" required
                        value="{{ student.last_name if student else '' }}">

                    <label class="admin-form-label">FIRSTNAME</label>
                    <input class="w3-input w3-border admin-form-input" type="text" name="first_name" required
                        value="{{ student.first_name if student else '' }}">

                    <label class="admin-form-label">COURSE</label>
                    <select class="w3-input w3-border admin-form-input" name="course">
                        <option value="" disabled {% if not student %}selected{% endif %}>Select Course</option>
                        <option value="BSIT" {% if student and student.course=="BSIT" %}selected{% endif %}>BSIT
                        </option>
                        <option value="BSCS" {% if student and student.course=="BSCS" %}selected{% endif %}>BSCS
                        </option>
                        <option value="BSHM" {% if student and student.course=="BSHM" %}selected{% endif %}>BSHM
                        </option>
                        <option value="BSTM" {% if student and student.course=="BSTM" %}selected{% endif %}>BSTM
                        </option>
                        <option value="BSED" {% if student and student.course=="BSED" %}selected{% endif %}>BSED
                        </option>
                    </select>

                    <label class="admin-form-label">LEVEL</label>
                    <select class="w3-input w3-border admin-form-input" name="level">
                        <option value="" disabled {% if not student %}selected{% endif %}>Select Level</option>
                        <option value="1" {% if student and student.level=="1" %}selected{% endif %}>1</option>
                        <option value="2" {% if student and student.level=="2" %}selected{% endif %}>2</option>
                        <option value="3" {% if student and student.level=="3" %}selected{% endif %}>3</option>
                        <option value="4" {% if student and student.level=="4" %}selected{% endif %}>4</option>
                    </select>

                </div>

                <!-- QR (centered) -->
                <div class="qr-section">
                    <label class="admin-form-label">QR CODE (IDNO)</label>
                    <div class="qr-box-wrapper">
                        <div id="qrcode-box" class="qr-box-student"></div>
                    </div>
                </div>

                <!-- BUTTONS -->
                <div class="student-form-buttons">
                    <a href="{{ url_for('students') }}" class="admin-btn-outline">CANCEL</a>
                    <button type="submit" class="admin-btn-primary">SAVE</button>
                </div>

            </form>
        </section>

    </div>

    <!-- JS LIBS (no inline script, all logic is in main.js) -->
    <script src="{{ url_for('static', filename='js/webcam.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/qrcode.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>